FROM node:16 AS builder

ARG NODE_ENV=production
ARG REACT_APP_DEPARTMENT_NAME="ALP Turk"
ARG REACT_APP_SERVER_API_PREFIX=https://www.alptr.com/api
ARG REACT_APP_SERVER_STATIC_PREFIX=https://www.alptr.com
ARG REACT_APP_WS_PREFIX=wss://www.alptr.com/alp-ws
ARG REACT_APP_FRONT_SENTRY_ENV=k8s-prod-alp-turk

ENV NODE_ENV=${NODE_ENV} \
	REACT_APP_DEPARTMENT_NAME=${REACT_APP_DEPARTMENT_NAME} \
	REACT_APP_SERVER_API_PREFIX=${REACT_APP_SERVER_API_PREFIX} \
	REACT_APP_SERVER_STATIC_PREFIX=${REACT_APP_SERVER_STATIC_PREFIX} \
	REACT_APP_WS_PREFIX=${REACT_APP_WS_PREFIX} \
	REACT_APP_FRONT_SENTRY_ENV=${REACT_APP_FRONT_SENTRY_ENV} \
	REACT_APP_DEPARTMENT_ADDRESS="ALP Turk Centex bilisim teknolojileri A.S., Evliya Celebi Cad. No. 23/106 Muratpasa / ANTALYA" \
	REACT_APP_FRONT_SENTRY_DSN=https://25484f03ed8c45b2a83a548de1b05c53@sentry.btc-alpha.io/5 \
	REACT_APP_FRONT_SENTRY_SAMPLE_RATE=0.2 \
	REACT_APP_DEVICEID_COOKIE_NAME=d \
	REACT_APP_SESSION_COOKIE_NAME=s \
	REACT_APP_CSRF_COOKIE_NAME=c \
	REACT_APP_HOST=https://www.alptr.com \
	REACT_APP_GA_ID="G-LB8VESZM5E" \
	REACT_APP_DEFAULT_TERMINAL_PAIR=BTC_USDT \
	REACT_APP_DEFAULT_TERMINAL_MARGIN_PAIR=BTC_USDT \
	REACT_APP_DEFAULT_BUY_CRYPTO_PAIR=USD_USDT \
	REACT_APP_TICKERS_QUOTED_CURRENCIES_BASE=USDT,TRY \
	# REACT_APP_TICKERS_QUOTED_CURRENCIES_FIAT=UAH,EUR,USD \
	REACT_APP_RATES_QUOTED_CURRENCIES=BTC,USDT \
	REACT_APP_MODULE_MOBILE_APP=true \
	REACT_APP_MODULE_PAYMENT_SERVICES=true \ 
	REACT_APP_MODULE_CHARITY=false \
	REACT_APP_MODULE_ALPHA_CODE=false \
	REACT_APP_MODULE_LISTING=false \
	REACT_APP_MODULE_SOCIAL_LISTING=false \
	REACT_APP_MODULE_MARGIN=true \
	REACT_APP_MODULE_REFERRALS=true \
	REACT_APP_MODULE_SUB_ACCOUNTS=true \
	REACT_APP_MODULE_TRANSFERS=true \
	REACT_APP_MODULE_COMPETITIONS=true \ 
	REACT_APP_MODULE_NEWS=true \ 
	REACT_APP_MODULE_STORIES=false \ 
	REACT_APP_MODULE_STAKING=true \
	REACT_APP_MODULE_COIN_INFO=false \ 
	REACT_APP_MODULE_BUY_CRYPTO=false \
	REACT_APP_MODULE_WELCOME_BONUS=false \
	REACT_APP_MODULE_HOME_STATS=false \
	REACT_APP_MODULE_SUPPORT_CENTER=false \
	REACT_APP_MODULE_ALP_COIN=true \
	REACT_APP_SALES_DOUBLER=false \
	REACT_APP_GOOGLE_PLAY=https://play.google.com/store/apps/details?id=com.alpturk.exchange \
	REACT_APP_APP_STORE=https://apps.apple.com/app/alp-turk-buy-sell-crypto/id1622005497 \
	REACT_APP_PUBLIC_API_PATH=https://btc-alpha.github.io/api-docs/ \
	REACT_APP_MOBILE_DOWNLOAD_LINK=https://alpturk.page.link/download

WORKDIR /app

COPY package*.json ./

RUN npm install --legacy-peer-deps

COPY . . 

RUN npm run build

ARG CI_COMMIT_SHORT_SHA=00000000
ENV SENTRY_RELEASE=${CI_COMMIT_SHORT_SHA}

FROM nginx:alpine

COPY --from=builder /app/build/ /usr/share/nginx/html/

COPY nginx.conf /etc/nginx/conf.d/default.conf
