FROM node:16 AS builder

ARG NODE_ENV=production
ARG REACT_APP_DEPARTMENT_NAME=BTC-Alpha
ARG REACT_APP_SERVER_API_PREFIX=https://btc-alpha.com/api
ARG REACT_APP_SERVER_STATIC_PREFIX=https://btc-alpha.com
ARG REACT_APP_WS_PREFIX=wss://btc-alpha.com/alp-ws
ARG REACT_APP_FRONT_SENTRY_ENV=k8s-prod-btc-alpha

ENV NODE_ENV=${NODE_ENV} \
	REACT_APP_DEPARTMENT_NAME=${REACT_APP_DEPARTMENT_NAME} \
	REACT_APP_SERVER_API_PREFIX=${REACT_APP_SERVER_API_PREFIX} \
	REACT_APP_SERVER_STATIC_PREFIX=${REACT_APP_SERVER_STATIC_PREFIX} \
	REACT_APP_WS_PREFIX=${REACT_APP_WS_PREFIX} \
	REACT_APP_FRONT_SENTRY_ENV=${REACT_APP_FRONT_SENTRY_ENV} \
	REACT_APP_DEPARTMENT_ADDRESS="Alphacom UAB, J. Savickio g. 4-7, LT-01108 Vilnius" \
	REACT_APP_FRONT_SENTRY_DSN=https://25484f03ed8c45b2a83a548de1b05c53@sentry.btc-alpha.io/5 \
	REACT_APP_FRONT_SENTRY_SAMPLE_RATE=0.2 \
	REACT_APP_DEVICEID_COOKIE_NAME=d \
	REACT_APP_SESSION_COOKIE_NAME=s \
	REACT_APP_CSRF_COOKIE_NAME=c \
	REACT_APP_HOST=https://btc-alpha.com \
	REACT_APP_GA_ID="UA-71682721-1" \
	REACT_APP_DEFAULT_TERMINAL_PAIR=BTC_USDT \
	REACT_APP_DEFAULT_TERMINAL_MARGIN_PAIR=BTC_USDT \
	REACT_APP_DEFAULT_BUY_CRYPTO_PAIR=USD_USDT \
	REACT_APP_TICKERS_QUOTED_CURRENCIES_BASE=BTC,USDT \
	REACT_APP_TICKERS_QUOTED_CURRENCIES_FIAT=UAH,EUR,USD \
	REACT_APP_RATES_QUOTED_CURRENCIES=BTC,USDT \
	REACT_APP_MODULE_MOBILE_APP=true \
	REACT_APP_MODULE_PAYMENT_SERVICES=true \ 
	REACT_APP_MODULE_CHARITY=true \
	REACT_APP_MODULE_ALPHA_CODE=true \
	REACT_APP_MODULE_LISTING=true \
	REACT_APP_MODULE_SOCIAL_LISTING=true \
	REACT_APP_MODULE_MARGIN=true \
	REACT_APP_MODULE_REFERRALS=true \
	REACT_APP_MODULE_SUB_ACCOUNTS=true \
	REACT_APP_MODULE_TRANSFERS=true \
	REACT_APP_MODULE_COMPETITIONS=true \ 
	REACT_APP_MODULE_NEWS=true \ 
	REACT_APP_MODULE_STORIES=true \ 
	REACT_APP_MODULE_STAKING=true \
	REACT_APP_MODULE_COIN_INFO=false \ 
	REACT_APP_MODULE_BUY_CRYPTO=true \
	REACT_APP_MODULE_WELCOME_BONUS=false \ 
	REACT_APP_MODULE_HOME_STATS=true \
	REACT_APP_MODULE_SUPPORT_CENTER=true \
	REACT_APP_SALES_DOUBLER=true \
	REACT_APP_MODULE_ALP_COIN=true \
	REACT_APP_GOOGLE_PLAY=https://play.google.com/store/apps/details?id=com.btcalpha.exchange \
  REACT_APP_APP_STORE=https://apps.apple.com/app/btc-alpha-buy-sell-bitcoin/id1437629304 \
	REACT_APP_PUBLIC_API_PATH=https://btc-alpha.github.io/api-docs/ \
	REACT_APP_MOBILE_DOWNLOAD_LINK=https://link.btc-alpha.io/app/download


WORKDIR /app

COPY package*.json ./

RUN npm install --legacy-peer-deps

COPY . . 

RUN npm run build

ARG CI_COMMIT_SHORT_SHA=00000000
ENV SENTRY_RELEASE=${CI_COMMIT_SHORT_SHA}

FROM nginx:alpine

COPY --from=builder /app/build/ /usr/share/nginx/html/

COPY nginx.conf /etc/nginx/conf.d/default.conf
